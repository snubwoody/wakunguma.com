---
import type {BlogPost} from "../../lib";
import { formatDate } from "../../lib/format";

type Props = {
    posts: BlogPost[]
};

const {posts}: Props = Astro.props;

const filters: Map<string,number> = new Map();
filters.set("All",posts.length);

posts.forEach(post => {
    const tags = post.frontmatter.tags;
    for (const tag of tags){
        const count = filters.get(tag);

        if (!count){
            filters.set(tag,1);
            continue;
        }

        filters.set(tag,count+1);
    }
});


const activeFilter = Astro.url.searchParams.get("filter") ?? "All";
let filteredPosts:BlogPost[];
if (activeFilter === "All") {
    filteredPosts = posts;
}else {
    filteredPosts = posts
        .filter(post => post.frontmatter.tags.includes(activeFilter));
}
---


<section class="p-24 md:px-40 md:py-44 space-y-36">
    <header class="space-y-12">
        <h3>Articles</h3>
        <ul class="flex gap-12 items-center">
            {Array.from(filters).map(([filter,count]) =>
            <li>
                <a
                    href=`/blog?filter=${filter}`
                    data-selected={activeFilter === filter}
                    class="filter-chip"
                >
                    {filter}
                    <span class="text-xs">{count}</span>
                </a>
            </li>

            )}
        </ul>
    </header>
    <ul class="blog-grid">
        {filteredPosts.map(post =>
            <li>
                <a href={post.url} class="blog-post" data-astro-prefetch>
                    <img src={post.frontmatter.image} alt="Thumbnail" class="rounded-md" loading="lazy">
                    <div class="grid place-items-center p-12">
                        <h4 class="mb-8 max-md:text-h5 font-bold text-center">{post.frontmatter.title}</h4>
                        <p class="text-sm">
                            {formatDate(post.frontmatter.published)}
                        </p>
                    </div>
                </a>
            </li>
        )}
    </ul>
</section>

<style>
    .filter-chip{
        display: flex;
        align-items: start;
        border: 1px solid transparent;
        transition: 150ms all;
        gap: 4px;
        padding: 4px 12px;
        border-radius: var(--radius-full);
        cursor: pointer;

        &:hover{
            border-color: var(--color-purple-100);
        }

        &[data-selected="true"]{
            background-color: var(--color-purple-100);
            color: var(--color-neutral-950);
        }

        [data-theme="light"] &:hover{
            border-color: var(--color-purple-500);
        }

        [data-theme="light"] &[data-selected="true"]{
            background-color: var(--color-purple-500);
            color: var(--color-purple-50);
        }
    }
</style>
